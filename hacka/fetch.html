<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch - JBsn</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Page-specific styles */
        .page-content {
            padding-top: 120px;
            padding-bottom: 80px;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--white) 0%, var(--orange-50) 100%);
        }

        .page-header {
            text-align: center;
            margin-bottom: 48px;
            padding: 0 24px;
        }

        .page-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--gray-900);
            margin-bottom: 12px;
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: var(--gray-600);
            max-width: 600px;
            margin: 0 auto;
        }

        .fetch-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 24px;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 32px;
            align-items: start;
        }

        /* Form Card */
        .form-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 20px;
            padding: 40px;
            box-shadow: var(--shadow-sm);
        }

        .form-header {
            margin-bottom: 32px;
        }

        .form-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 8px;
        }

        .form-header p {
            color: var(--gray-600);
            font-size: 0.95rem;
        }

        .form-group {
            margin-bottom: 24px;
        }

        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-700);
            margin-bottom: 8px;
        }

        .form-label .required {
            color: var(--orange-500);
            margin-left: 4px;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 14px 16px;
            font-size: 0.95rem;
            border: 2px solid var(--gray-200);
            border-radius: 12px;
            background: var(--white);
            color: var(--gray-900);
            transition: all 0.2s ease;
            font-family: inherit;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--orange-400);
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.1);
        }

        .form-input::placeholder {
            color: var(--gray-400);
        }

        .form-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 24 24' stroke='%2371717a'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M19 9l-7 7-7-7'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 44px;
        }

        .password-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--gray-500);
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .password-toggle:hover {
            color: var(--gray-700);
        }

        .password-toggle svg {
            width: 20px;
            height: 20px;
        }

        .form-hint {
            font-size: 0.8rem;
            color: var(--gray-500);
            margin-top: 6px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 32px;
        }

        .btn-submit {
            flex: 1;
            background: linear-gradient(135deg, var(--orange-500) 0%, var(--orange-600) 100%);
            color: var(--white);
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 14px 0 rgba(249, 115, 22, 0.4);
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, var(--orange-600) 0%, var(--orange-700) 100%);
            transform: translateY(-1px);
            box-shadow: 0 6px 20px 0 rgba(249, 115, 22, 0.5);
        }

        .btn-submit:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-test {
            background: var(--white);
            color: var(--gray-700);
            border: 2px solid var(--gray-200);
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn-test:hover {
            border-color: var(--orange-300);
            color: var(--orange-600);
            background: var(--orange-50);
        }

        /* Status Card */
        .status-card {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 96px;
        }

        .status-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 24px;
        }

        .status-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .status-icon.connected {
            background: #dcfce7;
            color: #16a34a;
        }

        .status-icon.disconnected {
            background: #fee2e2;
            color: #dc2626;
        }

        .status-icon.pending {
            background: #fef3c7;
            color: #d97706;
        }

        .status-icon svg {
            width: 24px;
            height: 24px;
        }

        .status-title {
            font-size: 1rem;
            font-weight: 700;
            color: var(--gray-900);
        }

        .status-subtitle {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 16px;
            background: var(--gray-50);
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }

        .status-dot.active {
            background: #22c55e;
            box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.2);
        }

        .status-dot.inactive {
            background: var(--gray-400);
            animation: none;
        }

        .status-dot.error {
            background: #ef4444;
            box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.2);
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .status-text {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .status-text.active {
            color: #16a34a;
        }

        .status-text.inactive {
            color: var(--gray-600);
        }

        .status-text.error {
            color: #dc2626;
        }

        .status-details {
            font-size: 0.85rem;
            color: var(--gray-600);
        }

        .status-details div {
            padding: 10px 0;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
        }

        .status-details div:last-child {
            border-bottom: none;
        }

        .status-label {
            color: var(--gray-500);
        }

        .status-value {
            font-weight: 600;
            color: var(--gray-900);
        }

        /* Saved Integrations */
        .integrations-section {
            margin-top: 32px;
        }

        .integrations-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--gray-900);
            margin-bottom: 16px;
        }

        .integration-item {
            background: var(--white);
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.2s ease;
        }

        .integration-item:hover {
            border-color: var(--orange-300);
            box-shadow: var(--shadow-md);
        }

        .integration-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }

        .integration-logo {
            width: 40px;
            height: 40px;
            background: var(--orange-100);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .integration-name {
            font-weight: 600;
            color: var(--gray-900);
            font-size: 0.95rem;
        }

        .integration-nickname {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .integration-status {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .integration-status.active {
            background: #dcfce7;
            color: #16a34a;
        }

        .integration-status.inactive {
            background: var(--gray-100);
            color: var(--gray-600);
        }

        .integration-actions {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            background: transparent;
            border: 1px solid var(--gray-300);
            color: var(--gray-600);
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .btn-icon:hover {
            background: var(--gray-100);
            border-color: var(--gray-400);
        }

        .btn-icon svg {
            width: 16px;
            height: 16px;
        }

        .empty-integrations {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-500);
            background: var(--gray-50);
            border-radius: 12px;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .fetch-container {
                grid-template-columns: 1fr;
            }

            .status-card {
                position: static;
                order: -1;
            }
        }

        @media (max-width: 768px) {
            .page-title {
                font-size: 2rem;
            }

            .form-card {
                padding: 28px 20px;
            }

            .form-actions {
                flex-direction: column;
            }

            .integration-item {
                flex-wrap: wrap;
                gap: 12px;
            }

            .integration-actions {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">‚ö°</span>
                <span class="logo-text">JBsn</span>
            </a>
            <ul class="nav-links">
                <li><a href="fetch.html" class="nav-link" style="color: var(--orange-600); background: var(--orange-50);">Fetch</a></li>
                <li><a href="add.html" class="nav-link">Add</a></li>
                <li><a href="analyze.html" class="nav-link">Analyze</a></li>
                <li><a href="history.html" class="nav-link">History</a></li>
            </ul>
            <button class="mobile-menu-btn" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </nav>

    <!-- Page Content -->
    <main class="page-content">
        <div class="page-header">
            <h1 class="page-title">Fetch Configuration</h1>
            <p class="page-subtitle">Set up external integrations to automatically retrieve financial files from banks and servers</p>
        </div>

        <div class="fetch-container">
            <!-- Configuration Form -->
            <div class="form-card">
                <div class="form-header">
                    <h2>API Integration Setup</h2>
                    <p>Configure your bank or financial institution connection</p>
                </div>

                <form id="fetchForm">
                    <div class="form-group">
                        <label class="form-label">
                            Bank / Institution
                            <span class="required">*</span>
                        </label>
                        <select class="form-select" id="bankName" required>
                            <option value="">Select a bank...</option>
                            <option value="itau">Ita√∫ Unibanco</option>
                            <option value="bradesco">Bradesco</option>
                            <option value="bb">Banco do Brasil</option>
                            <option value="santander">Santander</option>
                            <option value="nubank">Nubank</option>
                            <option value="inter">Banco Inter</option>
                            <option value="original">Banco Original</option>
                            <option value="safra">Banco Safra</option>
                            <option value="btg">BTG Pactual</option>
                            <option value="caixa">Caixa Econ√¥mica</option>
                            <option value="sicoob">Sicoob</option>
                            <option value="sicredi">Sicredi</option>
                            <option value="other">Other / Custom API</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            API Key
                            <span class="required">*</span>
                        </label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                class="form-input" 
                                id="apiKey" 
                                placeholder="Enter your API key"
                                required
                            >
                            <button type="button" class="password-toggle" onclick="togglePassword('apiKey')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                            </button>
                        </div>
                        <p class="form-hint">Your API key is encrypted and stored securely</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Client Secret
                            <span class="required">*</span>
                        </label>
                        <div class="password-wrapper">
                            <input 
                                type="password" 
                                class="form-input" 
                                id="clientSecret" 
                                placeholder="Enter your client secret"
                                required
                            >
                            <button type="button" class="password-toggle" onclick="togglePassword('clientSecret')">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                </svg>
                            </button>
                        </div>
                        <p class="form-hint">OAuth2 client secret for authentication</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">
                            Account Nickname
                            <span class="required">*</span>
                        </label>
                        <input 
                            type="text" 
                            class="form-input" 
                            id="accountNickname" 
                            placeholder="e.g., Main Business Account"
                            required
                        >
                        <p class="form-hint">A friendly name to identify this integration</p>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-test" id="testBtn">
                            Test Connection
                        </button>
                        <button type="submit" class="btn-submit">
                            Save Integration
                        </button>
                    </div>
                </form>

                <!-- Saved Integrations -->
                <div class="integrations-section">
                    <h3 class="integrations-title">Saved Integrations</h3>
                    <div id="integrationsList">
                        <div class="empty-integrations">
                            No integrations configured yet. Add your first integration above.
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Card -->
            <div class="status-card">
                <div class="status-header">
                    <div class="status-icon" id="statusIcon">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01"/>
                        </svg>
                    </div>
                    <div>
                        <div class="status-title">Connection Status</div>
                        <div class="status-subtitle">Bridge to external server</div>
                    </div>
                </div>

                <div class="status-indicator">
                    <div class="status-dot" id="statusDot"></div>
                    <span class="status-text" id="statusText">Checking...</span>
                </div>

                <div class="status-details" id="statusDetails">
                    <div>
                        <span class="status-label">Status</span>
                        <span class="status-value" id="statusValue">-</span>
                    </div>
                    <div>
                        <span class="status-label">Last Sync</span>
                        <span class="status-value" id="lastSync">-</span>
                    </div>
                    <div>
                        <span class="status-label">Active Integrations</span>
                        <span class="status-value" id="activeIntegrations">0</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // State
        let savedIntegrations = [];
        let connectionStatus = 'checking'; // checking, connected, disconnected

        // Bank icons mapping
        const bankIcons = {
            'itau': 'üü†',
            'bradesco': 'üî¥',
            'bb': 'üü°',
            'santander': 'üî¥',
            'nubank': 'üü£',
            'inter': 'üü†',
            'original': 'üîµ',
            'safra': 'üü°',
            'btg': '‚ö´',
            'caixa': 'üîµ',
            'sicoob': 'üü¢',
            'sicredi': 'üü¢',
            'other': 'üîó'
        };

        // DOM Elements
        const fetchForm = document.getElementById('fetchForm');
        const testBtn = document.getElementById('testBtn');
        const integrationsList = document.getElementById('integrationsList');
        const statusIcon = document.getElementById('statusIcon');
        const statusDot = document.getElementById('statusDot');
        const statusText = document.getElementById('statusText');
        const statusValue = document.getElementById('statusValue');
        const lastSync = document.getElementById('lastSync');
        const activeIntegrations = document.getElementById('activeIntegrations');

        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const button = input.parentElement.querySelector('.password-toggle');
            const icon = button.querySelector('svg');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>
                `;
            } else {
                input.type = 'password';
                icon.innerHTML = `
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                `;
            }
        }

        // Update connection status UI
        function updateConnectionStatus(status, integrationsCount = 0) {
            connectionStatus = status;
            
            // Update status dot
            statusDot.className = 'status-dot';
            if (status === 'connected') {
                statusDot.classList.add('active');
            } else if (status === 'disconnected') {
                statusDot.classList.add('inactive');
            } else {
                statusDot.classList.add('error');
            }

            // Update status text
            statusText.className = 'status-text';
            if (status === 'connected') {
                statusText.textContent = 'Connected';
                statusText.classList.add('active');
            } else if (status === 'disconnected') {
                statusText.textContent = 'Disconnected';
                statusText.classList.add('inactive');
            } else {
                statusText.textContent = 'Error';
                statusText.classList.add('error');
            }

            // Update status value
            statusValue.textContent = status === 'connected' ? 'Active' : 'Inactive';
            lastSync.textContent = status === 'connected' ? 'Just now' : '-';
            activeIntegrations.textContent = integrationsCount;

            // Update status icon
            statusIcon.className = 'status-icon';
            if (status === 'connected') {
                statusIcon.classList.add('connected');
                statusIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                `;
            } else if (status === 'disconnected') {
                statusIcon.classList.add('disconnected');
                statusIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"/>
                    </svg>
                `;
            } else {
                statusIcon.classList.add('pending');
                statusIcon.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                `;
            }
        }

        // Render saved integrations
        function renderIntegrations() {
            if (savedIntegrations.length === 0) {
                integrationsList.innerHTML = `
                    <div class="empty-integrations">
                        No integrations configured yet. Add your first integration above.
                    </div>
                `;
                updateConnectionStatus('disconnected', 0);
                return;
            }

            integrationsList.innerHTML = savedIntegrations.map((integration, index) => `
                <div class="integration-item">
                    <div class="integration-info">
                        <div class="integration-logo">${bankIcons[integration.bank] || 'üè¶'}</div>
                        <div>
                            <div class="integration-name">${integration.nickname}</div>
                            <div class="integration-nickname">${document.getElementById('bankName').querySelector(`option[value="${integration.bank}"]`).textContent}</div>
                        </div>
                    </div>
                    <span class="integration-status ${integration.active ? 'active' : 'inactive'}">
                        ${integration.active ? '‚óè Active' : '‚óã Inactive'}
                    </span>
                    <div class="integration-actions">
                        <button class="btn-icon" onclick="toggleIntegration(${index})" title="${integration.active ? 'Deactivate' : 'Activate'}">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${integration.active ? 'M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414' : 'M8.111 16.404a5.5 5.5 0 017.778 0M12 20h.01m-7.08-7.071c3.904-3.905 10.236-3.905 14.141 0M1.394 9.393c5.857-5.857 15.355-5.857 21.213 0'}"/>
                            </svg>
                        </button>
                        <button class="btn-icon" onclick="deleteIntegration(${index})" title="Delete">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                    </div>
                </div>
            `).join('');

            const activeCount = savedIntegrations.filter(i => i.active).length;
            updateConnectionStatus(activeCount > 0 ? 'connected' : 'disconnected', activeCount);
        }

        // Toggle integration active status
        function toggleIntegration(index) {
            savedIntegrations[index].active = !savedIntegrations[index].active;
            renderIntegrations();
        }

        // Delete integration
        function deleteIntegration(index) {
            if (confirm('Are you sure you want to delete this integration?')) {
                savedIntegrations.splice(index, 1);
                renderIntegrations();
            }
        }

        // Test connection
        testBtn.addEventListener('click', () => {
            const bankName = document.getElementById('bankName').value;
            const apiKey = document.getElementById('apiKey').value;
            const clientSecret = document.getElementById('clientSecret').value;

            if (!bankName || !apiKey || !clientSecret) {
                alert('Please fill in all required fields before testing the connection.');
                return;
            }

            // Show testing state
            testBtn.disabled = true;
            testBtn.textContent = 'Testing...';
            updateConnectionStatus('checking');

            // Simulate connection test
            setTimeout(() => {
                // Simulate success (80% chance) or failure
                const success = Math.random() > 0.2;
                
                if (success) {
                    updateConnectionStatus('connected');
                    alert('‚úÖ Connection successful! Your credentials are valid.');
                } else {
                    updateConnectionStatus('disconnected');
                    alert('‚ùå Connection failed. Please check your credentials and try again.');
                }

                testBtn.disabled = false;
                testBtn.textContent = 'Test Connection';
            }, 2000);
        });

        // Form submission
        fetchForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const bankName = document.getElementById('bankName').value;
            const apiKey = document.getElementById('apiKey').value;
            const clientSecret = document.getElementById('clientSecret').value;
            const accountNickname = document.getElementById('accountNickname').value;

            // Add new integration
            savedIntegrations.push({
                bank: bankName,
                apiKey: apiKey, // In production, encrypt this!
                clientSecret: clientSecret, // In production, encrypt this!
                nickname: accountNickname,
                active: true,
                createdAt: new Date().toISOString()
            });

            // Reset form
            fetchForm.reset();

            // Update UI
            renderIntegrations();

            alert('‚úÖ Integration saved successfully!');
        });

        // Mobile menu toggle
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navLinks = document.querySelector('.nav-links');

        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                navLinks.classList.toggle('active');
            });
        }

        // Initialize
        updateConnectionStatus('disconnected', 0);
    </script>
</body>
</html>
